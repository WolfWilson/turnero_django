{% extends "admin/base_admin.html" %}

{% block content %}
<!-- Header -->
<div class="content-header">
  <div class="breadcrumb">
    <i class="fas fa-home"></i>
    <span class="breadcrumb-separator">/</span>
    <span>Dashboard</span>
  </div>
  <h1 class="content-title">Panel de Control</h1>
  <p class="content-subtitle">Bienvenido, {{ request.user.get_full_name|default:request.user.username }}</p>
</div>

<!-- Estadísticas principales -->
<div class="dashboard-stats">
  <!-- Card: Pendientes Hoy -->
  <div class="stat-card">
    <div class="stat-card-header">
      <div class="stat-icon">
        <i class="fas fa-clock"></i>
      </div>
      <div class="stat-meta">
        <div class="stat-label">Hoy</div>
        <div class="stat-trend up">
          <i class="fas fa-arrow-up"></i>
          <span>Activo</span>
        </div>
      </div>
    </div>
    <div class="stat-card-body">
      <div class="stat-value">{{ stats.pendientes }}</div>
      <p class="stat-description">Turnos Pendientes</p>
    </div>
  </div>
  
  <!-- Card: En Atención -->
  <div class="stat-card">
    <div class="stat-card-header">
      <div class="stat-icon" style="background: rgba(76, 175, 80, 0.2); color: var(--color-success);">
        <i class="fas fa-user-check"></i>
      </div>
      <div class="stat-meta">
        <div class="stat-label">En Vivo</div>
        <div class="stat-trend">
          <i class="fas fa-circle" style="color: var(--color-success);"></i>
          <span>Online</span>
        </div>
      </div>
    </div>
    <div class="stat-card-body">
      <div class="stat-value" style="color: var(--color-success);">{{ stats.en_atencion|add:stats.llamando }}</div>
      <p class="stat-description">En Atención Ahora</p>
    </div>
  </div>
  
  <!-- Card: Finalizados Hoy -->
  <div class="stat-card">
    <div class="stat-card-header">
      <div class="stat-icon" style="background: rgba(33, 150, 243, 0.2); color: var(--color-info);">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-meta">
        <div class="stat-label">Hoy</div>
      </div>
    </div>
    <div class="stat-card-body">
      <div class="stat-value" style="color: var(--color-info);">{{ stats.finalizados }}</div>
      <p class="stat-description">Turnos Completados</p>
    </div>
  </div>
  
  <!-- Card: Vencidos (pendientes de días anteriores) -->
  <div class="stat-card">
    <div class="stat-card-header">
      <div class="stat-icon" style="background: rgba(255, 152, 0, 0.2); color: var(--color-warning);">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="stat-meta">
        <div class="stat-label">Acumulado</div>
      </div>
    </div>
    <div class="stat-card-body">
      <div class="stat-value" style="color: var(--color-warning);">{{ stats.pendientes_vencidos }}</div>
      <p class="stat-description">Turnos Vencidos</p>
    </div>
  </div>

  <!-- Card: No se presentaron -->
  <div class="stat-card">
    <div class="stat-card-header">
      <div class="stat-icon" style="background: rgba(244, 67, 54, 0.2); color: var(--color-danger);">
        <i class="fas fa-user-slash"></i>
      </div>
      <div class="stat-meta">
        <div class="stat-label">Hoy</div>
      </div>
    </div>
    <div class="stat-card-body">
      <div class="stat-value" style="color: var(--color-danger);">{{ stats.no_presento }}</div>
      <p class="stat-description">No se Presentaron</p>
    </div>
  </div>
  
  <!-- Card: Total del Día -->
  <div class="stat-card">
    <div class="stat-card-header">
      <div class="stat-icon" style="background: rgba(156, 39, 176, 0.2); color: #9c27b0;">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="stat-meta">
        <div class="stat-label">Total</div>
      </div>
    </div>
    <div class="stat-card-body">
      <div class="stat-value" style="color: #9c27b0;">{{ stats.total_hoy }}</div>
      <p class="stat-description">Turnos del Día</p>
    </div>
  </div>
</div>

<!-- Sección de Turnos Recientes -->
<div class="turnos-section">
  <div class="section-header">
    <h2 class="section-title">
      <i class="fas fa-list"></i>
      Turnos Recientes
    </h2>
    <div class="section-actions">
      <a href="{% url 'turnos:monitor' %}" class="btn btn-secondary" target="_blank">
        <i class="fas fa-tv"></i>
        Ver Monitor
      </a>
      <a href="{% url 'turnos:turnero_public' %}" class="btn btn-primary" target="_blank">
        <i class="fas fa-plus"></i>
        Nuevo Turno
      </a>
    </div>
  </div>
  
  <div class="turnos-list">
    {% for turno in turnos_recientes %}
    <div class="turno-item">
      <div class="turno-number">{{ turno.numero_visible|stringformat:"03d" }}</div>
      <div class="turno-info">
        <h4 class="turno-name">
          {% if turno.ticket.persona %}
            {{ turno.ticket.persona.apellido|upper }}, {{ turno.ticket.persona.nombre|title }}
          {% else %}
            Sin identificar
          {% endif %}
        </h4>
        <div class="turno-details">
          <span class="turno-detail-item">
            <i class="fas fa-briefcase"></i>
            {{ turno.tramite.nombre }}
          </span>
          <span class="turno-detail-item">
            <i class="fas fa-clock"></i>
            {{ turno.fecha_hora_creacion|date:"H:i" }}
          </span>
          <span class="turno-detail-item">
            <i class="fas fa-building"></i>
            {% if turno.mesa_asignada %}{{ turno.mesa_asignada.nombre }}{% else %}—{% endif %}
          </span>
        </div>
      </div>
      <div class="turno-estado
        {% if turno.estado_id == 0 %}pendiente
        {% elif turno.estado_id == 1 %}llamando
        {% elif turno.estado_id == 2 %}en-atencion
        {% elif turno.estado_id == 3 %}finalizado
        {% elif turno.estado_id == 4 %}no-presento
        {% elif turno.estado_id == 5 %}derivado
        {% endif %}">
        <i class="fas
          {% if turno.estado_id == 0 %}fa-clock
          {% elif turno.estado_id == 1 %}fa-bell
          {% elif turno.estado_id == 2 %}fa-user-check
          {% elif turno.estado_id == 3 %}fa-check-circle
          {% elif turno.estado_id == 4 %}fa-user-slash
          {% elif turno.estado_id == 5 %}fa-share
          {% endif %}"></i>
        {{ turno.estado.nombre }}
      </div>
    </div>
    {% empty %}
    <div class="empty-state">
      <i class="fas fa-inbox"></i>
      <h3>No hay turnos hoy</h3>
      <p>Los turnos aparecerán aquí cuando se emitan desde el tótem</p>
      <a href="{% url 'turnos:turnero_public' %}" class="btn btn-primary" target="_blank">
        <i class="fas fa-plus"></i>
        Emitir Primer Turno
      </a>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Sección de Accesos Rápidos -->
<div class="dashboard-stats" style="margin-top: var(--space-xl);">
  <div class="glass-card">
    <div class="glass-card-header">
      <div class="glass-card-icon" style="background: rgba(156, 39, 176, 0.2); color: #9c27b0;">
        <i class="fas fa-headset"></i>
      </div>
      <h3 class="glass-card-title">Panel de Operador</h3>
    </div>
    <div class="glass-card-body">
      <p>Acceso al panel de atención de turnos para operadores</p>
    </div>
    <div class="glass-card-footer">
      <a href="{% url 'atencion:panel' %}" class="btn btn-primary">
        <i class="fas fa-arrow-right"></i>
        Abrir
      </a>
    </div>
  </div>
  
  <div class="glass-card">
    <div class="glass-card-header">
      <div class="glass-card-icon">
        <i class="fas fa-tv"></i>
      </div>
      <h3 class="glass-card-title">Monitor Público</h3>
    </div>
    <div class="glass-card-body">
      <p>Pantalla para sala de espera con estado de turnos en tiempo real</p>
    </div>
    <div class="glass-card-footer">
      <a href="{% url 'turnos:monitor' %}" class="btn btn-secondary" target="_blank">
        <i class="fas fa-external-link-alt"></i>
        Abrir
      </a>
    </div>
  </div>
  
  <div class="glass-card">
    <div class="glass-card-header">
      <div class="glass-card-icon" style="background: rgba(76, 175, 80, 0.2); color: var(--color-success);">
        <i class="fas fa-tablet-screen-button"></i>
      </div>
      <h3 class="glass-card-title">Tótem Autoservicio</h3>
    </div>
    <div class="glass-card-body">
      <p>Pantalla táctil para emisión de turnos por el público</p>
    </div>
    <div class="glass-card-footer">
      <a href="{% url 'turnos:turnero_public' %}" class="btn btn-success" target="_blank">
        <i class="fas fa-external-link-alt"></i>
        Abrir
      </a>
    </div>
  </div>
  
  {% if request.user.is_superuser or request.user.is_staff %}
  <div class="glass-card">
    <div class="glass-card-header">
      <div class="glass-card-icon" style="background: rgba(255, 193, 7, 0.2); color: var(--color-warning);">
        <i class="fas fa-cog"></i>
      </div>
      <h3 class="glass-card-title">Configuración</h3>
    </div>
    <div class="glass-card-body">
      <p>Administración del sistema, usuarios, áreas y trámites</p>
    </div>
    <div class="glass-card-footer">
      <a href="/admin/" class="btn btn-warning" target="_blank">
        <i class="fas fa-external-link-alt"></i>
        Abrir
      </a>
    </div>
  </div>
  {% endif %}
</div>

<!-- Estilos para estados de turno en la lista -->
<style>
  .turno-estado {
    padding: 0.35rem 0.85rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
  }
  .turno-estado.pendiente    { background: rgba(255,193,7,0.15); color: #ffc107; }
  .turno-estado.llamando     { background: rgba(33,150,243,0.15); color: #2196f3; }
  .turno-estado.en-atencion  { background: rgba(76,175,80,0.15); color: #4caf50; }
  .turno-estado.finalizado   { background: rgba(0,200,83,0.15); color: #00c853; }
  .turno-estado.no-presento  { background: rgba(244,67,54,0.15); color: #f44336; }
  .turno-estado.derivado     { background: rgba(156,39,176,0.15); color: #9c27b0; }
  .dashboard-stats { flex-wrap: wrap; }
</style>
{% endblock %}
